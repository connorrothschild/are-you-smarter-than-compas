<!DOCTYPE html>
    <meta charset="utf-8">
    <title>Are You Smarter Than COMPAS? | Connor Rothschild</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">

    <meta name="twitter:card" content="summary_large_image" >
    <meta name="twitter:site" content="@CL_Rothschild" >
    <meta name="twitter:creator" content="@CL_Rothschild" >
    <meta name="twitter:title" content="Are You Smarter Than a Criminal Justice Algorithm?" >
    <meta name="twitter:description" content="Probably." >
    <meta name="twitter:image" content="https://raw.githubusercontent.com/connorrothschild/are-you-smarter-than-compas/master/images/thumbnail.jpg" >

    <link rel="icon" href="https://raw.githubusercontent.com/connorrothschild/connorrothschild.github.io/master/me/favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/blocks.css/dist/blocks.min.css" />
    <script src="https://d3js.org/d3.v4.min.js"></script>

 <body>

<meta name="author" content="Connor Rothschild"/>

    <h1>
      <!-- <img src = "images/header.png" width = 600> -->
      <span style = "font-weight:600">Are You Smarter Than <span class = "glitch" data-text = "COMPAS?">COMPAS?</span></span>
      <br><span style="font-size:80%">Probably.</span>
      <br><span style="font-size:45%">By <a target = "_blank" href = "https://connorrothschild.github.io">Connor Rothschild</a></span>
      <hr>
    </h1>

  <h2>
    <p>COMPAS is a criminal justice algorithm used to... Lorem ipsum dolor sit amet, labore laboramus ut nam, eum et debet populo efficiantur. No ius lorem assum epicurei, no per luptatum mandamus, usu ea vivendum disputando. Pri probo discere qualisque eu, ei summo senserit duo. Ad vim erat ludus facete. Vim te atqui vituperatoribus.</p>
    <p>In 2016, COMPAS came under national scrutiny when ProPublica... Lorem ipsum dolor sit amet, labore laboramus ut nam, eum et debet populo efficiantur. No ius lorem assum epicurei, no per luptatum mandamus, usu ea vivendum disputando. Pri probo discere qualisque eu, ei summo senserit duo. Ad vim erat ludus facete. Vim te atqui vituperatoribus.</p>
    <p>In 2018, two researchers conducted a study on... Lorem ipsum dolor sit amet, labore laboramus ut nam, eum et debet populo efficiantur. No ius lorem assum epicurei, no per luptatum mandamus, usu ea vivendum disputando. Pri probo discere qualisque eu, ei summo senserit duo. Ad vim erat ludus facete. Vim te atqui vituperatoribus.</p>
  </h2>

    <h2>
        <form>
          <button id="submitButton" class="block" type = "button" onclick="newPerson()">Show a Defendant</button>
        </form>

        <div class = "big-box" id = "big-box">
        <span class = "figure-container" id = "offense" style = "font-size:22px;line-height:1.5em"></span>
        <div class="figure-container" >
            <figure class="center number number--large" id = "age">
            </figure>
            <figure class="center text" id = "sex">
            </figure>
          </div>
          <div class="figure-container" >
            <figure class="center number number--large" id = "priors">
            </figure>
            <figure class="center number number--large" id = "juvenileCount">
            </figure>
          </div>
        </div>

      <p class = "demographic" id = "selected_person"></p>
      <p id = "reoffend" style = "font-size:24px"></p>
      <div class="figure-container" >
          <figure class="center number number--large" id = "userInput">
          </figure>
          <figure class="center number number--large" id = "compasInput">
          </figure>
        </div>
      <p id = "reveal"></p>
      <div class="row">
          <div class="column blue">Your accuracy: 
            <br><span id = "yourAccuracy"></span></div>
          <div class="column red">COMPAS accuracy: 
            <br><span id = "compasAccuracy"></span></div>
      </div>
    </h2>
    
<footer>
  <b>Note: </b>
  Note.
  <br><br>
  <b>Source: </b>
  Source.
  <br><br>
  <b>Who made this? </b>
  Me, Connor Rothschild! Learn more about me <a target="_blank" href = "https://connorrothschild.github.io">here</a>.
</footer>

</body>

<script>

var selected_person;

var total_guesses = 0;
var compas_correct_score = 0;
var user_correct_score = 0;
var compas_correct_percentage;
var user_correct_percentage;
var user_input;
var compas_input;
var user_correct;
var compas_correct;
var onlyClickOnce;

// load the data
d3.csv(
	'./data/final_data.csv',
	function(d) {
		d.age = +d.age;
		return d;
	},
	function(error, datafile) {
		if (error) throw error;

		// put the original data in csv
		data = datafile;
		console.log(data);

		// create a random person function
		randomize = function(data) {
			var randomPerson = data[Math.floor(Math.random() * data.length)];
			return randomPerson;
    };

		newPerson = function() {

      // every time that user refreshes for a new person, reset this counter (see more below)
      onlyClickOnce = 0;

      // change box opacity
      document.getElementById('big-box').setAttribute("class", "big-box-visible");

      // remove prior "confirmation" text
      d3.select('#reveal')
        .html(function(d,i) {   
              return null
        })

      d3.select('#userInput')
        .html(function(d,i) {   
              return null
        })

      d3.select('#compasInput')
        .html(function(d,i) {   
              return null
      })

			// select a random person
			selected_person = randomize(data);
      console.log(selected_person);
    
			d3.select('#age').html(function(d, i) {
				return '<div><p><strong>' + selected_person.age + '</strong></p></div>' +
                  '<p>The age of the defendant</p>'
      });

      d3.select('#sex').html(function(d, i) {
				return '<div><p><strong>' + selected_person.sex + '</strong></p></div>' +
                  '<p>The sex of the defendant</p>'
      });

      d3.select('#priors').html(function(d, i) {
				return '<div><p><strong>' + selected_person.priors_count + '</strong></p></div>' +
                  '<p>Prior convictions</p>'
      });

      d3.select('#juvenileCount').html(function(d, i) {
				return '<div><p><strong>' + selected_person.juv_total_count + '</strong></p></div>' +
                  '<p>Juvenile charges</p>'
      });
      
      d3.select('#offense').html(function(d, i) {
        return '<div><p>Charge: <strong>' 
          + selected_person.charge_text + '</strong> (' + selected_person.charge_degree 
          + ')</p></div>'
      });
      
      d3.select('#reoffend').html(function(d, i) {
        return 'Is this person likely to reoffend? ' +
         '<button id="yesButton" class="inline block themedGreen" type = "button" onclick="yesFunction()">Yes!</button>' +
         '<button id="noButton" class="inline block themedRed" type = "button" onclick="noFunction()">No!</button>'
      });

      yesFunction = function(d) {

        // increment only click once
        onlyClickOnce++;

        // if the user has clicked on a yes or no button more than once, ignore their input
        if (onlyClickOnce > 1) {
          null
        } else {

        total_guesses++;

        if (selected_person.compas_guess == "1" && selected_person.compas_correct == "1") {
         
            user_input = "Yes";
            compas_input = "Yes";
            user_correct = "Yes";
            compas_correct = "Yes";
            // increment both correct scores
            compas_correct_score++;
            user_correct_score++;
            
        } else if (selected_person.compas_guess == "0" && selected_person.compas_correct == "0") {
          
            user_input = "Yes";
            compas_input = "No";
            user_correct = "Yes";
            compas_correct = "No";

            // increment user correct score
            user_correct_score++;

        } else if (selected_person.compas_guess == "0" && selected_person.compas_correct == "1") {
          
            user_input = "Yes";
            compas_input = "No";
            user_correct = "No";
            compas_correct = "Yes";

            // increment compas correct score
            compas_correct_score++;
            
        } else if (selected_person.compas_guess == "1" && selected_person.compas_correct == "0") {
           
            user_input = "Yes";
            compas_input = "Yes";
            user_correct = "No";
            compas_correct = "No";

        }

        user_correct_percentage = (user_correct_score/total_guesses)*100;
        compas_correct_percentage = (compas_correct_score/total_guesses)*100;

        console.log("User has " + user_correct_score + " correct guesses.")
        console.log("COMPAS has " + compas_correct_score + " correct guesses.")
        console.log("Total guesses: " + total_guesses)
        console.log("User accuracy: " + user_correct_percentage)
        console.log("COMPAS accuracy: " + compas_correct_percentage)

      d3.select('#yourAccuracy').html(function(d, i) {
        if (user_correct_percentage > compas_correct_percentage) {
          return Math.round(user_correct_percentage) + "% (" + user_correct_score + " out of " + total_guesses + ") 😄"
        } else {
          return Math.round(user_correct_percentage) + "% (" + user_correct_score + " out of " + total_guesses + ") "
        }
      });

      d3.select('#compasAccuracy').html(function(d, i) {
        
         if (compas_correct_percentage >= user_correct_percentage) {
          return Math.round(compas_correct_percentage) + "% (" + compas_correct_score + " out of " + total_guesses + ") 😡"
        } else {
          return Math.round(compas_correct_percentage) + "% (" + compas_correct_score + " out of " + total_guesses + ")"
        }
      });

      d3.select('#userInput').html(function(d, i) {
        if (user_correct == "Yes") {
        return "<p>Your guess: </p>" + 
          '<div><p><strong>' + user_input + ' ✅ </strong></p></div>'
        } else {
          return "<p>Your guess: </p>" + 
          '<div><p><strong>' + user_input + ' ❌ </strong></p></div>'
        }
      });

      d3.select('#compasInput').html(function(d, i) {
        if (compas_correct == "Yes") {
        return "<p>COMPAS's guess: </p>" + 
          '<div><p><strong>' + compas_input + ' ✅ </strong></p></div>'
        } else {
          return "<p>COMPAS's guess: </p>" + 
          '<div><p><strong>' + compas_input + ' ❌ </strong></p></div>'
        }
      });

      d3.select("#reveal").html(function(d, i) {
        if (user_correct == "Yes" && compas_correct == "Yes") {
          return "You were <strong>both right</strong>! "
          + '<button id="submitButton" class="block inline" type = "button" onclick="newPerson()">Show me a New Defendant</button>'
        } else if (user_correct == "Yes" && compas_correct == "No") {
          return "You were <strong>right</strong> and COMPAS was <strong>wrong</strong>! "
          + '<button id="submitButton" class="block inline" type = "button" onclick="newPerson()">Show me a New Defendant</button>'
        } else if (user_correct == "No" && compas_correct == "Yes") {
          return "You were <strong>wrong</strong> and COMPAS was <strong>right</strong>! "
          + '<button id="submitButton" class="block inline" type = "button" onclick="newPerson()">Show me a New Defendant</button>'
        } else if (user_correct == "No" && compas_correct == "No") {
          return "You were <strong>both wrong</strong>! "
          + '<button id="submitButton" class="block inline" type = "button" onclick="newPerson()">Show me a New Defendant</button>'
        } 
      });

      }
    }
    };

      noFunction = function(d) {

        // increment only click once
        onlyClickOnce++;

        // if the user has clicked on a yes or no button more than once, ignore their input
        if (onlyClickOnce > 1) {
          null
        } else {

        total_guesses++;

        if (selected_person.compas_guess == "1" && selected_person.compas_correct == "1") {
          
            user_input = "No";
            compas_input = "Yes";
            user_correct = "No";
            compas_correct = "Yes";
            // increment compas correct score
            compas_correct_score++;

        } else if (selected_person.compas_guess == "0" && selected_person.compas_correct == "0") {
          
            user_input = "No";
            compas_input = "No";
            user_correct = "No";
            compas_correct = "No";

        } else if (selected_person.compas_guess == "0" && selected_person.compas_correct == "1") {
          
            user_input = "No";
            compas_input = "No";
            user_correct = "Yes";
            compas_correct = "Yes";

            //increment both scores
            compas_correct_score++;
            user_correct_score++;

        } else if (selected_person.compas_guess == "1" && selected_person.compas_correct == "0") {
            user_input = "No";
            compas_input = "Yes";
            user_correct = "Yes";
            compas_correct = "No";
            
            // increment user correct score
            user_correct_score++;
        }

        user_correct_percentage = (user_correct_score/total_guesses)*100;
        compas_correct_percentage = (compas_correct_score/total_guesses)*100;

        console.log("User has " + user_correct_score + " correct guesses.")
        console.log("COMPAS has " + compas_correct_score + " correct guesses.")
        console.log("Total guesses: " + total_guesses)
        console.log("User accuracy: " + user_correct_percentage)
        console.log("COMPAS accuracy: " + compas_correct_percentage)

        d3.select('#yourAccuracy').html(function(d, i) {
        if (user_correct_percentage > compas_correct_percentage) {
          return Math.round(user_correct_percentage) + "% (" + user_correct_score + " out of " + total_guesses + ") 😄"
        } else {
          return Math.round(user_correct_percentage) + "% (" + user_correct_score + " out of " + total_guesses + ") "
        }
      });

        d3.select('#compasAccuracy').html(function(d, i) {
        
         if (compas_correct_percentage >= user_correct_percentage) {
          return Math.round(compas_correct_percentage) + "% (" + compas_correct_score + " out of " + total_guesses + ") 😡"
        } else {
          return Math.round(compas_correct_percentage) + "% (" + compas_correct_score + " out of " + total_guesses + ")"
        }
      });

      d3.select('#userInput').html(function(d, i) {
        if (user_correct == "Yes") {
        return "<p>Your guess: </p>" + 
          '<div><p><strong>' + user_input + ' ✅ </strong></p></div>'
        } else {
          return "<p>Your guess: </p>" + 
          '<div><p><strong>' + user_input + ' ❌ </strong></p></div>'
        }
      });

      d3.select('#compasInput').html(function(d, i) {
        if (compas_correct == "Yes") {
        return "<p>COMPAS's guess: </p>" + 
          '<div><p><strong>' + compas_input + ' ✅ </strong></p></div>'
        } else {
          return "<p>COMPAS's guess: </p>" + 
          '<div><p><strong>' + compas_input + ' ❌ </strong></p></div>'
        }
      });

      d3.select("#reveal").html(function(d, i) {
        if (user_correct == "Yes" && compas_correct == "Yes") {
          return "You were <strong>both right</strong>! "
          + '<button id="submitButton" class="block inline" type = "button" onclick="newPerson()">Show me a New Defendant</button>'
        } else if (user_correct == "Yes" && compas_correct == "No") {
          return "You were <strong>right</strong> and COMPAS was <strong>wrong</strong>! "
          + '<button id="submitButton" class="block inline" type = "button" onclick="newPerson()">Show me a New Defendant</button>'
        } else if (user_correct == "No" && compas_correct == "Yes") {
          return "You were <strong>wrong</strong> and COMPAS was <strong>right</strong>! "
          + '<button id="submitButton" class="block inline" type = "button" onclick="newPerson()">Show me a New Defendant</button>'
        } else if (user_correct == "No" && compas_correct == "No") {
          return "You were <strong>both wrong</strong>! " 
          + '<button id="submitButton" class="block inline" type = "button" onclick="newPerson()">Show me a New Defendant</button>'
        } 
      });

      };
      }
	}
);

  </script>